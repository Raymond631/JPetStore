<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zlp.jpetstore_spring.mapper.OrderMapper">

    <select id="getOrderList" resultType="order">
        select * from order_main where user_Id = #{userId} order by order_time desc
    </select>

    <select id="getOrderDetails" resultMap="order">
        select * from order_main where order_id = #{orderId}
    </select>
    <resultMap type="Order" id="order">
        <id property="orderId" column="order_id" />
        <result property="orderTime" column="order_time" />
        <result property="orderCost" column="order_cost" />
        <result property="orderPayment" column="order_payment" />
        <result property="receiverName" column="receiver_name" />
        <result property="receiverPhone" column="receiver_phone" />
        <result property="receiverAddress" column="receiver_address" />
        <collection property="orderItemList" column="order_id" select="selectOrderItemById" ofType="orderItem" />
    </resultMap>
    <select id="selectOrderItemById" resultType="orderItem">
        select * from order_item where order_id = #{orderId}
    </select>


    <update id="updateWhetherShip">
        update order_item set whether_ship = #{whetherShip} where order_item_id = #{orderItemId}
    </update>


    <select id="selectReceiver" resultType="com.zlp.jpetstore_spring.entity.Receiver">
        select * from user_receiver where user_id = #{userId}
    </select>



    <select id="selectStock" resultType="java.lang.Integer">
        select item_stock from pet_item where item_id = #{itemId}
    </select>
    <insert id="insertOrderMain">
        <selectKey keyProperty="orderId" order="AFTER" resultType="java.lang.Long">
            select last_insert_id()
        </selectKey>
        insert into order_main (user_id,order_time,order_cost,order_payment,receiver_name,receiver_phone,receiver_address) values (#{userId},#{orderTime},#{orderCost},#{orderPayment},#{receiverName},#{receiverPhone},#{receiverAddress})
    </insert>
    <insert id="insertOrderItem">
        insert into order_item (order_id,item_id,product_id,item_image,product_name_Chinese,item_specification,item_price,item_quantity,whether_ship,supplier) values (#{orderId},#{itemId},#{productId},#{itemImage},#{productNameChinese},#{itemSpecification},#{itemPrice},#{itemQuantity},#{whetherShip},#{supplier})
    </insert>
    <update id="updateStock">
        update pet_item set item_stock = #{itemStock} where item_id = #{itemId}
    </update>
    <delete id="deleteFromCart">
        delete from cart where user_id = #{userId} and item_id = #{itemId}
    </delete>
</mapper>